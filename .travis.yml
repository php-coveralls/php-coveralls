language: php

matrix:
    include:
        - php: 5.6
        - php: 7.0
        - php: 7.1
        - php: hhvm

sudo: false

cache:
    directories:
        - $HOME/.composer/cache

before_script:
    - mkdir -p build/logs
    - composer install --no-progress --no-ansi --no-interaction --profile

script:
    - composer test
    - composer sca

after_success:
    - php tests/bin/ocular.phar code-coverage:upload --format=php-clover build/logs/clover.xml --verbose
    - php bin/coveralls --config=.coveralls.yml --coverage_clover=build/logs/clover.xml --verbose

deploy:
    provider: releases
    api_key:
        secure: EH3xkaLCQIK4YToB4pFHz4L9Uhjh1eG5tG2i94OP6R3KVfmC3fugSTQSchKwlkJYdTl/Uj7Px0YUr0H0FeCvmi4lVai/NEM2PGthv6s6bO69MmivKhjkceqgcuDSDHsu/eNb0+4VC6jC7g6vGfTeKNUj17QQgLyFyG1kFN5xqbM=
    file: build/artifacts/coveralls.phar
    skip_cleanup: true
    on:
        repo: satooshi/php-coveralls
        tags: true
        all_branches: true
        condition: $BOX = yes

# vim:fdl=0:sts=4:sw=4:ts=4
