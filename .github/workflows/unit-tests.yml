name: UnitTests

on:
    - pull_request
    - push

jobs:
    tests:
        name: "PHP ${{ matrix.php }} + Composer ${{ matrix.dependency }} + Symfony ${{ matrix.symfony }}"
        runs-on: ubuntu-latest

        strategy:
            fail-fast: true
            matrix:
                include:
                    -   php: '5.5'
                        dependency: lowest
                        coverage: xdebug
                        symfony: '*'
                    -   php: '5.5'
                        dependency: highest
                        coverage: xdebug
                        symfony: '*'
                    -   php: '5.6'
                        dependency: highest
                        coverage: xdebug
                        symfony: '*'
                    -   php: '7.0'
                        dependency: highest
                        coverage: xdebug
                        symfony: '*'
                    -   php: '7.1'
                        dependency: highest
                        coverage: xdebug
                        symfony: '^3.0'
                    -   php: '7.2'
                        dependency: highest
                        coverage: pcov
                        symfony: '^4.0'
                    -   php: '7.3'
                        dependency: highest
                        coverage: pcov
                        symfony: '^5.0'
                    -   php: '7.4'
                        dependency: highest
                        coverage: pcov
                        symfony: '^5.0'

        steps:
            -   name: Checkout source
                uses: actions/checkout@v2

            -   name: PHP setup
                uses: shivammathur/setup-php@v2
                with:
                    php-version: ${{ matrix.php }}
                    coverage: ${{ matrix.coverage }}

            -   name: Require Symfony version
                if: matrix.symfony != '*'
                run: |
                    composer global require --no-interaction --no-progress symfony/flex:^1.11
                    composer config extra.symfony.require ${{ matrix.symfony }}

            -   name: Update composer dependencies
                run: composer update --optimize-autoloader --no-interaction --no-progress ${{ matrix.composer-flags }}

            -   name: Run test suite
                run: ./vendor/bin/phpunit -v

# TODO: need to setup from maintainer
#            -   name: Check bin/php-coveralls successfully run
#                run: bin/php-coveralls -v --exclude-no-stmt
